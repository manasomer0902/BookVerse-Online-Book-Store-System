<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookVerse | Online Computer Book Store</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
</head>
<body>

<header class="navbar">
  <a href="/" class="logo">
    <img src="/images/logo.png" alt="BookVerse Logo">
    <span>BookVerse | Online Computer Book Store</span>
  </a>

  <nav>
    <a href="/" class="active">Home</a>
    <a href="/about">About</a>
    <a href="/books">View Books</a>
    <a href="/contact">Contact</a>
    <a href="/reviews">Feedback</a>

    <span id="myOrdersLink"></span>

    <a href="#" class="cart-icon" onclick="openCart()">
      ðŸ›’ <span id="cartCount" class="cart-badge">0</span>
    </a>

    <span id="authArea"></span>
  </nav>
</header>

<section class="hero">
  <h1>Online Computer Book Store</h1>
  <p>Buy and manage computer books online.</p>
  <a href="/books" class="btn-primary">Browse Books</a>
</section>

<section class="books-section">
  <h2>Featured Books</h2>

  <div class="book-grid">
    <div class="book-card">
      <img src="/images/book1.jpg">
      <h3>Java Programming Simplified</h3>
      <p class="price">â‚¹499</p>
      <button onclick="addToCart('Java-Programming-Simplified', 499, '/images/book1.jpg')">Add to Cart</button>
    </div>

    <div class="book-card">
      <img src="/images/book2.jpg">
      <h3>Data Structures & Algorithms</h3>
      <p class="price">â‚¹599</p>
      <button onclick="addToCart('Data-Structures & Algorithms', 599, '/images/book2.jpg')">Add to Cart</button>
    </div>

    <div class="book-card">
      <img src="/images/book3.jpg">
      <h3>Web Proramming with HTML, CSS and JavaScript</h3>
      <p class="price">â‚¹699</p>
      <button onclick="addToCart('Web Programming with Html Css and Javascript', 699, '/images/book3.jpg')">Add to Cart</button>
    </div>
  </div>
</section>

<footer class="footer">
  <p>Â© 2026 BookVerse â€“ All Rights Reserved.</p>
</footer>

<script>
const authArea = document.getElementById("authArea");
const myOrdersLink = document.getElementById("myOrdersLink");
const cartCountEl = document.getElementById("cartCount");

const isLoggedIn = localStorage.getItem("isLoggedIn");
const userName = localStorage.getItem("userName");

if (isLoggedIn === "true") {
  authArea.innerHTML = `
    <span class="user-name">ðŸ‘¤ ${userName || "User"}</span>
    <a href="#" class="btn login-btn" onclick="logout()">Logout</a>
  `;
  myOrdersLink.innerHTML = `<a href="/my-orders">My Orders</a>`;
} else {
  authArea.innerHTML = `
    <a href="/login" class="btn login-btn">Login</a>
    <a href="/signup" class="btn signup-btn">Sign Up</a>
  `;
}

function logout() {
  localStorage.clear();
  window.location.href = "/";
}

function openCart() {
  if (localStorage.getItem("isLoggedIn") === "true") {
    window.location.href = "/cart";
  } else {
    alert("Please login first");
    window.location.href = "/login";
  }
}

// âœ… FIXED ENDPOINT
async function loadCartCount() {
  const userId = localStorage.getItem("userId");
  if (!userId) return;

  try {
    const res = await fetch(`/api/cart/${userId}`);
    const data = await res.json();

    let count = 0;
    if (data.items) {
      data.items.forEach(i => count += i.quantity);
    }

    cartCountEl.innerText = count;
  } catch {
    cartCountEl.innerText = 0;
  }
}

loadCartCount();

async function addToCart(name, price, image) {
  const userId = localStorage.getItem("userId");

  if (!userId) {
    alert("Please login first");
    window.location.href = "/login";
    return;
  }

  await fetch("/api/cart/add-to-cart", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, name, price, image })
  });

  loadCartCount(); // ðŸ”¥ instant update
  alert("Book added to cart");
}
</script>

</body>
</html>
