<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Cart | BookVerse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

</head>
<body>

<header class="navbar">
  <a href="/" class="logo">
    <img src="/images/logo.png">
    <span>BookVerse</span>
  </a>
</header>

<section class="cart-section">
  <h2>My Cart</h2>

  <div id="cartItems"></div>

  <div class="cart-summary">
    <h3>Total: ‚Çπ<span id="totalAmount">0</span></h3>
    <button class="btn-primary" onclick="proceedToOrder()">Proceed to Order</button>
  </div>
</section>

<script>
const userId = localStorage.getItem("userId");
if (!userId) {
  alert("Please login");
  window.location.href = "/login";
}

async function loadCart() {
  const res = await fetch(`/api/cart/${userId}`);
  const data = await res.json();

  const cartItems = document.getElementById("cartItems");
  const total = document.getElementById("totalAmount");

  cartItems.innerHTML = "";

  if (!data.items || data.items.length === 0) {
    cartItems.innerHTML = "<p>Your cart is empty.</p>";
    total.innerText = "0";
    return;
  }

  data.items.forEach(item => {
    cartItems.innerHTML += `
      <div class="cart-item">
        <img src="${item.image}">
        <div>
          <h4>${item.name}</h4>
          <p>‚Çπ${item.price}</p>

          <div style="display:flex;gap:10px;align-items:center">
            <button onclick="decrease('${item.name}')">‚ûñ</button>
            <strong>${item.quantity}</strong>
            <button onclick="increase('${item.name}')">‚ûï</button>
            <button onclick="removeItem('${item.name}')">üóëÔ∏è</button>
          </div>
        </div>
      </div>
    `;
  });

  total.innerText = data.totalAmount;
}

async function increase(name) {
  await fetch("/api/cart/increase", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, name })
  });
  loadCart();
}

async function decrease(name) {
  await fetch("/api/cart/decrease", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, name })
  });
  loadCart();
}

async function removeItem(name) {
  if (!confirm("Remove item completely?")) return;

  await fetch("/api/cart/remove-item", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, name })
  });
  loadCart();
}

function proceedToOrder() {
  const total = parseInt(document.getElementById("totalAmount").innerText);
  if (total === 0) {
    alert("Cart is empty");
    return;
  }
  window.location.href = "/order";
}

loadCart();
</script>

</body>
</html>
