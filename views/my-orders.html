<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Orders | BookVerse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>

<!-- NAVBAR -->
<header class="navbar">
  <a href="/" class="logo">
    <img src="/images/logo.png">
    <span>BookVerse | Online Computer Book Store</span>
  </a>

  <nav>
    <a href="/">Home</a>
    <a href="/books">View Books</a>
    <a href="/contact">Contact</a>

    <a href="/cart" class="cart-icon">ðŸ›’</a>
    <span id="authArea"></span>
  </nav>
</header>

<!-- ORDERS -->
<section class="order-section">
  <div class="order-card">
    <h2>My Orders</h2>
    <div id="orders"></div>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <p>Â© 2026 BookVerse â€“ Online Computer Book Store. All Rights Reserved.</p>
</footer>

<script>
const userId = localStorage.getItem("userId");

if (!userId) {
  alert("Please login first");
  window.location.href = "/login";
}

async function loadOrders() {
  const res = await fetch(`/api/order/my-orders/${userId}`);
  const orders = await res.json();

  const div = document.getElementById("orders");
  div.innerHTML = "";

  if (orders.length === 0) {
    div.innerHTML = "<p>No orders found.</p>";
    return;
  }

  orders.forEach(order => {
    let cancelBtn = "";

    if (order.orderStatus === "Confirmed") {
      cancelBtn = `
        <button onclick="cancelOrder('${order._id}')"
          style="margin-top:10px"
          class="btn-primary">
          Cancel Order
        </button>
      `;
    }

    div.innerHTML += `
      <div class="order-card">
        <p><strong>Order ID:</strong> ${order._id}</p>
        <p><strong>Total:</strong> â‚¹${order.totalAmount}</p>
        <p><strong>Status:</strong> ${order.orderStatus}</p>
        <p><strong>Refund:</strong> ${order.refundStatus}</p>
        ${cancelBtn}
        <hr>
      </div>
    `;
  });
}

async function cancelOrder(orderId) {
  if (!confirm("Are you sure you want to cancel this order?")) return;

  const res = await fetch("/api/order/cancel", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ orderId })
  });

  const data = await res.json();

  alert(data.message);
  loadOrders();
}

loadOrders();
</script>


</body>
</html>
